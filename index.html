<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspired Digits</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .difficulty-btn {
            transition: all 0.2s ease-in-out;
        }
        .number-card {
            transition: all 0.3s ease-in-out;
            transform: scale(0.9);
            opacity: 0;
            cursor: pointer;
        }
        .number-card.visible {
            transform: scale(1);
            opacity: 1;
        }
        .number-card.used {
            background-color: #d1d5db; /* gray-400 */
            color: #6b7280; /* gray-500 */
            cursor: not-allowed;
            transform: scale(0.95);
        }
        .solution-panel {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .solution-panel.visible {
            max-height: 1000px; /* Adjust as needed */
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Inspired Digits</h1>
            <p class="text-lg text-gray-600 mt-2">Create puzzles for different Depth of Knowledge (DOK) levels.</p>
        </header>

        <!-- DOK Explanations (omitted for brevity in this view, but present in the code) -->
        <div class="mb-8 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-center mb-4">Depth of Knowledge Levels</h2>
            <div id="dok-tabs" class="flex flex-col sm:flex-row justify-center border-b mb-4">
                <button data-level="mild" class="dok-tab p-4 text-green-600 border-b-2 border-green-600 font-semibold">Mild (DOK 1)</button>
                <button data-level="medium" class="dok-tab p-4 text-gray-500 font-semibold">Medium (DOK 2)</button>
                <button data-level="spicy" class="dok-tab p-4 text-gray-500 font-semibold">Spicy (DOK 3)</button>
                <button data-level="extreme" class="dok-tab p-4 text-gray-500 font-semibold">Extreme (DOK 4)</button>
            </div>
            <div id="dok-content" class="text-center text-gray-700 min-h-[80px]">
                <div data-level="mild" class="dok-panel">
                    <h3 class="font-bold text-lg text-green-700">Recall & Reproduction</h3>
                    <p>Puzzles require simple recall of math facts. Solutions are usually one or two steps and involve basic arithmetic (+, -, ×, ÷). The focus is on direct computation.</p>
                </div>
                <div data-level="medium" class="dok-panel hidden">
                    <h3 class="font-bold text-lg text-yellow-700">Skills & Concepts</h3>
                    <p>Puzzles require multiple steps and understanding the order of operations (GEMDAS). Students must apply concepts to solve the problem, often using most of the numbers provided.</p>
                </div>
                <div data-level="spicy" class="dok-panel hidden">
                    <h3 class="font-bold text-lg text-orange-700">Strategic Thinking</h3>
                    <p>Puzzles require students to devise a plan and think strategically. Solutions are not obvious and may require finding non-linear combinations or working backward from the target number.</p>
                </div>
                 <div data-level="extreme" class="dok-panel hidden">
                    <h3 class="font-bold text-lg text-red-700">Extended Thinking & Creative Problem Solving</h3>
                    <p>Puzzles demand complex reasoning and creative approaches. Solutions may require thinking outside standard rules, such as using fractions or negative numbers as intermediate steps to reach the final whole number target.</p>
                </div>
            </div>
        </div>

        <!-- Puzzle Generator -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex flex-col sm:flex-row justify-center items-center gap-3 mb-6">
                <button id="btn-mild" data-level="mild" class="difficulty-btn w-full sm:w-auto text-lg font-semibold py-3 px-6 bg-green-500 text-white rounded-lg shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75">Mild</button>
                <button id="btn-medium" data-level="medium" class="difficulty-btn w-full sm:w-auto text-lg font-semibold py-3 px-6 bg-yellow-500 text-white rounded-lg shadow hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75">Medium</button>
                <button id="btn-spicy" data-level="spicy" class="difficulty-btn w-full sm:w-auto text-lg font-semibold py-3 px-6 bg-orange-500 text-white rounded-lg shadow hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-75">Spicy</button>
                <button id="btn-extreme" data-level="extreme" class="difficulty-btn w-full sm:w-auto text-lg font-semibold py-3 px-6 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75">Extreme</button>
            </div>
            
            <div class="text-center mb-6">
                 <button id="generate-btn" class="text-lg font-semibold py-3 px-8 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                    Generate New Puzzle
                </button>
            </div>

            <!-- Puzzle Display -->
            <div class="flex flex-col md:flex-row items-center justify-around gap-6 p-4 bg-gray-50 rounded-lg">
                <div class="text-center">
                    <h3 class="text-xl font-semibold text-gray-500 mb-2">TARGET</h3>
                    <div id="target-number" class="w-48 h-24 flex items-center justify-center bg-blue-100 text-blue-800 text-5xl font-bold rounded-xl shadow-inner">
                        ...
                    </div>
                </div>
                <div class="text-center">
                    <h3 class="text-xl font-semibold text-gray-500 mb-2">NUMBERS</h3>
                    <div id="numbers-container" class="grid grid-cols-3 gap-3">
                        <!-- Numbers will be injected here -->
                    </div>
                </div>
            </div>

             <!-- Player Interaction Area -->
            <div id="interaction-area" class="mt-8 bg-gray-100 p-4 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold text-center mb-4 text-gray-700">Build Your Solution</h3>

                <div id="player-input-display" class="w-full bg-white h-16 text-3xl font-mono p-2 rounded-md shadow-inner text-right mb-4 overflow-x-auto flex items-center justify-end"></div>
                <div id="feedback-panel" class="mb-4 text-center font-semibold text-lg h-8"></div>

                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">(</button>
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">)</button>
                    <button id="undo-btn" class="py-3 bg-yellow-500 text-white rounded-md text-xl font-bold col-span-2 hover:bg-yellow-600">Undo</button>
                    
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">+</button>
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">-</button>
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">*</button>
                    <button class="op-btn py-3 bg-gray-300 rounded-md text-2xl font-bold hover:bg-gray-400">/</button>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button id="clear-btn" class="py-3 bg-red-500 text-white rounded-md text-xl font-bold hover:bg-red-600">Clear</button>
                    <button id="check-btn" class="py-3 bg-green-500 text-white rounded-md text-xl font-bold hover:bg-green-600">Check</button>
                </div>
            </div>


            <!-- Solution Area -->
            <div class="mt-6 text-center">
                <div class="flex justify-center gap-4">
                    <button id="solution-btn" class="py-2 px-6 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">Show One Solution</button>
                    <button id="all-solutions-btn" class="py-2 px-6 bg-indigo-200 text-indigo-800 font-semibold rounded-lg hover:bg-indigo-300">Show All Solutions</button>
                </div>
                <div id="solution-panel" class="solution-panel mt-4 bg-green-50 p-4 rounded-lg text-left">
                    <h3 id="solution-title" class="font-bold text-green-800">Possible Solution:</h3>
                    <div id="solution-text" class="text-lg text-green-900 font-mono"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const dokTabs = document.querySelectorAll('.dok-tab');
        const dokPanels = document.querySelectorAll('.dok-panel');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const generateBtn = document.getElementById('generate-btn');
        const targetNumberEl = document.getElementById('target-number');
        const numbersContainer = document.getElementById('numbers-container');
        const solutionBtn = document.getElementById('solution-btn');
        const allSolutionsBtn = document.getElementById('all-solutions-btn');
        const solutionPanel = document.getElementById('solution-panel');
        const solutionTitle = document.getElementById('solution-title');
        const solutionText = document.getElementById('solution-text');
        // New Interactive Elements
        const playerInputDisplay = document.getElementById('player-input-display');
        const operatorBtns = document.querySelectorAll('.op-btn');
        const checkBtn = document.getElementById('check-btn');
        const clearBtn = document.getElementById('clear-btn');
        const undoBtn = document.getElementById('undo-btn');
        const feedbackPanel = document.getElementById('feedback-panel');


        // --- State ---
        let currentLevel = 'mild';
        let currentPuzzle = {};
        let inputStack = []; // For tracking user input for undo functionality

        // --- Utility Functions ---
        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
        
        const evaluateExpression = (expr) => {
            // Replace display symbols with JS operators
            const safeExpr = expr.replace(/×/g, '*').replace(/÷/g, '/');
            try {
                // Basic validation to prevent unsafe evaluation
                if (/[^0-9+\-*/().\s]/.test(safeExpr)) {
                    throw new Error("Invalid characters in expression");
                }
                return new Function('return ' + safeExpr)();
            } catch (error) {
                return null;
            }
        };

        // --- Puzzle Generation Logic ---
        function generatePuzzle(level) {
            let numbers = [], solutionNumbers = [], target = 0, solution = '';
            // (Generation logic is the same as before, so it's omitted here for brevity)
            if (level === 'mild') {
                const num1 = randInt(1, 10);
                const num2 = randInt(1, 10);
                const op = ['+', '*', '-'][randInt(0, 2)];
                if (op === '-' && num1 < num2) {
                    [solutionNumbers, solution] = [[num2, num1], `${num2} - ${num1}`];
                } else {
                    [solutionNumbers, solution] = [[num1, num2], `${num1} ${op} ${num2}`];
                }
                target = evaluateExpression(solution);
                numbers = [...solutionNumbers];
                while (numbers.length < 4) numbers.push(randInt(1, 25));
            } else if (level === 'medium') {
                const [num1, num2, num3] = [randInt(1, 15), randInt(1, 15), randInt(2, 10)];
                const [op1, op2] = [['+', '-', '*'][randInt(0, 2)], ['+', '-', '*'][randInt(0, 2)]];
                solutionNumbers = [num1, num2, num3];
                solution = `(${num1} ${op1} ${num2}) ${op2} ${num3}`;
                target = evaluateExpression(solution);
                numbers = [...solutionNumbers];
                while (numbers.length < 5) numbers.push(randInt(1, 25));
            } else if (level === 'spicy') {
                const [num1, num2, num3, num4] = [randInt(5, 25), randInt(2, 10), randInt(5, 25), randInt(2, 10)];
                solutionNumbers = [num1, num2, num3, num4];
                solution = randInt(0, 1) ? `(${num1} + ${num2}) * (${num3} - ${num4})` : `(${num1} * ${num2}) + (${num3} + ${num4})`;
                target = evaluateExpression(solution);
                numbers = [...solutionNumbers];
                while (numbers.length < 6) numbers.push(randInt(1, 50));
            } else if (level === 'extreme') {
                 const num2 = randInt(2, 10);
                 const [num1, num3, num4] = [randInt(10, 25), randInt(1, 5) * num2, randInt(num1 + 1, num1 + 10)];
                 solutionNumbers = [num1, num2, num3, num4];
                 solution = `(${num3} / ${num2}) * (${num1} - ${num4} + 20)`;
                 target = evaluateExpression(solution);
                 if(target === null || target < 10) return generatePuzzle('extreme');
                 numbers = [...solutionNumbers];
                 while (numbers.length < 6) numbers.push(randInt(1, 75));
            }
            if (target === null || target < 1 || !Number.isInteger(target) || target > 1000) return generatePuzzle(level);
            return { numbers: shuffle(numbers), target, solution };
        }
        
        // --- UI Update & Interaction Logic ---
        function updateUI(puzzle) {
            currentPuzzle = puzzle;
            targetNumberEl.textContent = puzzle.target;
            
            numbersContainer.innerHTML = '';
            puzzle.numbers.forEach((num, index) => {
                const card = document.createElement('button');
                card.className = 'number-card w-24 h-16 flex items-center justify-center bg-gray-200 text-gray-800 text-3xl font-semibold rounded-lg shadow-md';
                card.textContent = num;
                card.dataset.value = num;
                card.addEventListener('click', () => handleNumberClick(num, card));
                numbersContainer.appendChild(card);
                setTimeout(() => card.classList.add('visible'), index * 100);
            });
            
            resetInput();
            solutionPanel.classList.remove('visible');
            solutionText.innerHTML = '';
        }

        function handleNumberClick(num, cardElement) {
            if (cardElement.classList.contains('used')) return;
            inputStack.push({ type: 'number', value: num, element: cardElement });
            cardElement.classList.add('used');
            updateInputDisplay();
        }

        function handleOperatorClick(op) {
            // Use display-friendly symbols
            const displayOp = op.replace('*', '×').replace('/', '÷');
            inputStack.push({ type: 'operator', value: displayOp });
            updateInputDisplay();
        }

        function updateInputDisplay() {
            playerInputDisplay.textContent = inputStack.map(item => item.value).join(' ');
            feedbackPanel.textContent = ''; // Clear feedback on new input
        }
        
        function resetInput() {
            inputStack = [];
            document.querySelectorAll('.number-card').forEach(c => c.classList.remove('used'));
            updateInputDisplay();
        }

        undoBtn.addEventListener('click', () => {
            if (inputStack.length === 0) return;
            const lastItem = inputStack.pop();
            if (lastItem.type === 'number') {
                lastItem.element.classList.remove('used');
            }
            updateInputDisplay();
        });

        clearBtn.addEventListener('click', resetInput);

        checkBtn.addEventListener('click', () => {
            const expression = playerInputDisplay.textContent;
            if (!expression) return;

            const result = evaluateExpression(expression);

            if (result === null) {
                feedbackPanel.textContent = 'Invalid Expression';
                feedbackPanel.className = 'mb-4 text-center font-semibold text-lg h-8 text-yellow-600';
            } else if (result === currentPuzzle.target) {
                feedbackPanel.textContent = 'Correct!';
                feedbackPanel.className = 'mb-4 text-center font-semibold text-lg h-8 text-green-600';
            } else {
                feedbackPanel.textContent = `Incorrect. Your result is ${result}`;
                feedbackPanel.className = 'mb-4 text-center font-semibold text-lg h-8 text-red-600';
            }
        });


        function setActiveLevel(level) {
            currentLevel = level;
            difficultyButtons.forEach(btn => btn.classList.remove('ring-4', 'ring-green-400', 'ring-yellow-400', 'ring-orange-400', 'ring-red-400'));
            document.getElementById(`btn-${level}`).classList.add('ring-4', `ring-${getRingColor(level)}-400`);
            dokTabs.forEach(tab => {
                const tabLevel = tab.dataset.level, color = getTabColor(tabLevel);
                tab.classList.toggle(`text-${color}-600`, tabLevel === level);
                tab.classList.toggle(`border-${color}-600`, tabLevel === level);
                tab.classList.toggle('text-gray-500', tabLevel !== level);
                tab.style.borderColor = tabLevel === level ? '' : 'transparent';
            });
            dokPanels.forEach(panel => panel.classList.toggle('hidden', panel.dataset.level !== level));
        }
        
        const getRingColor = level => ({ mild: 'green', medium: 'yellow', spicy: 'orange', extreme: 'red' }[level] || 'blue');
        const getTabColor = level => ({ mild: 'green', medium: 'yellow', spicy: 'orange', extreme: 'red' }[level] || 'gray');

        // --- Solver ---
        function findAllSolutions(numbers, target) {
            const solutions = new Set();
            const allowCreative = currentLevel === 'extreme';
            function solve(nums, path = []) {
                if (nums.length === 1) {
                    if (Math.abs(nums[0].value - target) < 0.001) solutions.add(nums[0].expr);
                    return;
                }
                for (let i = 0; i < nums.length; i++) {
                    for (let j = i + 1; j < nums.length; j++) {
                        const a = nums[i], b = nums[j];
                        const rest = nums.filter((_, k) => k !== i && k !== j);
                        solve(rest.concat({ value: a.value + b.value, expr: `(${a.expr} + ${b.expr})` }), path);
                        if (a.value > b.value || allowCreative) solve(rest.concat({ value: a.value - b.value, expr: `(${a.expr} - ${b.expr})` }), path);
                        if (b.value > a.value || allowCreative) solve(rest.concat({ value: b.value - a.value, expr: `(${b.expr} - ${a.expr})` }), path);
                        solve(rest.concat({ value: a.value * b.value, expr: `(${a.expr} * ${b.expr})` }), path);
                        if (b.value !== 0 && (Number.isInteger(a.value / b.value) || allowCreative)) solve(rest.concat({ value: a.value / b.value, expr: `(${a.expr} / ${b.expr})` }), path);
                        if (a.value !== 0 && (Number.isInteger(b.value / a.value) || allowCreative)) solve(rest.concat({ value: b.value / a.value, expr: `(${b.expr} / ${a.expr})` }), path);
                    }
                }
            }
            solve(numbers.map(n => ({ value: n, expr: `${n}` })));
            return Array.from(solutions);
        }

        // --- Event Listeners ---
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveLevel(button.dataset.level);
                updateUI(generatePuzzle(currentLevel));
            });
        });
        generateBtn.addEventListener('click', () => updateUI(generatePuzzle(currentLevel)));
        solutionBtn.addEventListener('click', () => {
            if (currentPuzzle.solution) {
                solutionTitle.textContent = 'Possible Solution:';
                solutionText.innerHTML = `<p>${currentPuzzle.solution.replace('*','×').replace('/','÷')} = ${currentPuzzle.target}</p>`;
                solutionPanel.classList.toggle('visible');
            }
        });
        allSolutionsBtn.addEventListener('click', () => {
            solutionTitle.textContent = 'Finding All Solutions...';
            solutionText.innerHTML = '<div class="text-center p-4">Searching...</div>';
            solutionPanel.classList.add('visible');
            setTimeout(() => {
                const solutions = findAllSolutions(currentPuzzle.numbers, currentPuzzle.target);
                solutionTitle.textContent = `Found ${solutions.length} Solution(s):`;
                if (solutions.length > 0) {
                    solutionText.innerHTML = solutions.map(s => `<p>${s.replace('*','×').replace('/','÷')} = ${currentPuzzle.target}</p>`).join('');
                } else {
                    solutionText.innerHTML = '<p>No solutions found with the given numbers.</p>';
                }
            }, 50);
        });
        dokTabs.forEach(tab => tab.addEventListener('click', () => setActiveLevel(tab.dataset.level)));
        operatorBtns.forEach(btn => btn.addEventListener('click', () => handleOperatorClick(btn.textContent)));

        // --- Initial Load ---
        window.addEventListener('DOMContentLoaded', () => {
            setActiveLevel('mild');
            updateUI(generatePuzzle(currentLevel));
        });
    </script>
</body>
</html>


